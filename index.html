<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />

		<!-- load kaltura-player-js -->
		<!-- <script src="../dist/kaltura-ovp-player.js" type="text/javascript"></script> -->
	</head>
	<body>
		<!-- https://www.youtube.com/watch?v=MuWYvwh6uqs -->
		<!-- https://muxed.s3.amazonaws.com/ink.mp4 -->
		<!-- DYNAMIC EMBED embedPlaykit (works loading ../dist/kaltura-ovp-player.js OR https://cdnapisec.kaltura.com/p/4298703/embedPlaykitJs/uiconf_id/48786693 ) -->
		<h1>2021 DYNAMIC EMBED (embeds playkit)</h1>
		<script
			type="text/javascript"
			src="https://cdnapisec.kaltura.com/p/4298703/embedPlaykitJs/uiconf_id/48786693"
		></script>
		<div id="kalturaPlayer" style="width: 560px; height: 395px"></div>
		<button id="next_button" onClick="nextVideo()">Next Video Source</button>
		<script>
			function nextVideo() {
				DEkalturaPlayer.configure({
					playback: {
						streamPriority: [
							{
								engine: 'html5',
								format: 'progressive',
							},
						],
					},
				});

				DEkalturaPlayer.setMedia({
					sources: {
						progressive: [
							{
								mimetype: 'video/mp4',
								url: 'http://vjs.zencdn.net/v/oceans.mp4',
								id: '3',
							},
						],
					},
				});
			}
			var config = {
				targetId: 'kalturaPlayer',
				sources: {
					progressive: [
						{
							mimetype: 'video/mp4',
							url: 'https://muxed.s3.amazonaws.com/ink.mp4',
						},
					],
				},
				provider: {
					partnerId: 4298703,
				},
				playback: {
					autoplay: true,
				},
			};

			try {
				var DEkalturaPlayer = KalturaPlayer.setup(config);
				//playerready[works]
				this.DEkalturaPlayer.ready().then(console.log('player ready')).catch(console.log('player not ready'));

				this.DEkalturaPlayer.ready().then(() => {
					//videochange
					DEkalturaPlayer.addEventListener(DEkalturaPlayer.Event.CHANGE_SOURCE_STARTED, (event) => {
						console.log(event.type);
					});

					DEkalturaPlayer.addEventListener(DEkalturaPlayer.Event.CHANGE_SOURCE_ENDED, (event) => {
						console.log(event.type);
					});

					//play[works]
					DEkalturaPlayer.addEventListener(DEkalturaPlayer.Event.Core.PLAY, (event) => {
						const payload = event.payload;
						console.log(event.type);
					});
					//playing[works]
					DEkalturaPlayer.addEventListener(DEkalturaPlayer.Event.Core.PLAYING, (event) => {
						const payload = event.payload;
						console.log(event.type);
					});
					//pause[works]
					DEkalturaPlayer.addEventListener(DEkalturaPlayer.Event.Core.PAUSE, (event) => {
						const payload = event.payload;
						console.log(event.type);
					});
					//timeupdate[works]
					DEkalturaPlayer.addEventListener(DEkalturaPlayer.Event.Core.TIME_UPDATE, (event) => {
						const payload = event.payload;
						console.log(event.type);
					});
					//seeking[works]
					DEkalturaPlayer.addEventListener(DEkalturaPlayer.Event.Core.SEEKING, (event) => {
						const payload = event.payload;
						console.log(event.type);
					});
					//seeked[works]
					DEkalturaPlayer.addEventListener(DEkalturaPlayer.Event.Core.SEEKED, (event) => {
						const payload = event.payload;
						console.log(event.type);
					});
					//error
					DEkalturaPlayer.addEventListener(DEkalturaPlayer.Event.Core.ERROR, (event) => {
						const payload = event.payload;
						console.log(event.type);
					});
					//ended[works]
					DEkalturaPlayer.addEventListener(DEkalturaPlayer.Event.Core.ENDED, (event) => {
						const payload = event.payload;
						console.log(event.type);
					});

					//TODO: heartbeat, renditionchange, orientationchange
				});
			} catch (e) {
				console.error(e.message);
			}
		</script>
	</body>
</html>
